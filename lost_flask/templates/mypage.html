<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒã‚¤ãƒšãƒ¼ã‚¸ - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=9">
</head>
<body>
    <a href="{{ url_for('index') }}">
        <img src="{{ url_for('static', filename='Blueonly.png') }}" alt="å¤§å­¦ãƒ­ã‚´" id="logo-banner">
    </a>

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="user-header">
        <a href="{{ url_for('swipe_page') }}" class="header-action-btn">
            âš¡ é«˜é€Ÿãƒ¬ãƒ“ãƒ¥ãƒ¼
        </a>

        <div class="dropdown" tabindex="0">
            <div class="dropbtn">
                <span>{{ current_user.username }} ã•ã‚“</span>
                <span style="font-size: 0.8em; margin-left: 5px;">â–¼</span>
            </div>
            <div class="dropdown-content">
                <a href="{{ url_for('mypage') }}">ğŸ‘¤ ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
                <a href="{{ url_for('my_favorites') }}">ğŸ’– ãŠæ°—ã«å…¥ã‚Šè¬›ç¾©</a>
                <a href="{{ url_for('help_page') }}">â“ ä½¿ã„æ–¹</a>
                <a href="{{ url_for('logout') }}" class="logout-item">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
            </div>
        </div>
    </div>

    <div class="container">
        <header class="main-header">
            <h1 class="app-title">ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="flash-message {{ category }}">{{ message }}</div>
              {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- â–¼â–¼â–¼ è¿½åŠ : ãƒ¬ãƒ™ãƒ«ãƒ»ãƒ©ãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ â–¼â–¼â–¼ -->
        {% set level_info = user.get_level_info() %}
        <div class="level-card {{ level_info.style_class }}">
            <div class="level-header">
                <div class="level-icon-large">{{ level_info.icon }}</div>
                <div class="level-info">
                    <h3>Reviewer Rank</h3>
                    <div class="level-rank-title">{{ level_info.title }} <span style="font-size:0.6em; font-weight:normal; color:#666;">(Lv.{{ level_info.level }})</span></div>
                </div>
            </div>
            
            <div class="level-desc">{{ level_info.desc }}</div>
            
            {% if level_info.next_goal %}
            <div class="level-progress-area">
                <div class="level-progress-text">
                    <span>æ¬¡ã®ãƒ©ãƒ³ã‚¯ã¾ã§</span>
                    <span>ã‚ã¨ <strong>{{ level_info.next_goal }}</strong> ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
                </div>
            </div>
            {% else %}
            <div class="level-progress-area">
                <div class="level-progress-text" style="justify-content:center; color:var(--warning-color);">
                    <span>ğŸ‰ æœ€é«˜ãƒ©ãƒ³ã‚¯ã«åˆ°é”ã—ã¾ã—ãŸï¼</span>
                </div>
            </div>
            {% endif %}
        </div>
        <!-- â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–² -->

        <!-- ãƒãƒƒã‚¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="badge-section" style="max-width: 600px; margin: 0 auto 30px; background: #fff; padding: 20px; border-radius: 16px; border: 1px solid #e2e8f0;">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.4em; color: var(--primary-color);">ğŸ† å®Ÿç¸¾ãƒãƒƒã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h2>
            <div class="badge-container">
                {% for badge in all_badges %}
                    {% if badge in user.badges %}
                        <!-- ç²å¾—æ¸ˆã¿ãƒãƒƒã‚¸ -->
                        <div class="badge-item awarded">
                            <div class="badge-icon">{{ badge.icon }}</div>
                            <div class="badge-name">{{ badge.name }}</div>
                            <div class="badge-desc">{{ badge.description }}</div>
                        </div>
                    {% else %}
                        <!-- æœªç²å¾—ãƒãƒƒã‚¸ (ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ) -->
                        <div class="badge-item locked">
                            <div class="badge-icon">ğŸ”’</div>
                            <div class="badge-name">???</div>
                            <div class="badge-desc">{{ badge.description }}</div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </section>

        <section style="max-width: 600px; margin: 0 auto;">
            <div class="auth-container" style="margin-top: 0; padding: 40px; box-shadow: none; border: none; background: transparent;">
                <h2 style="text-align: center; margin-bottom: 30px;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h2>
                
                <form method="post">
                    <label class="form-label-block">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
                    <input type="text" name="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" value="{{ user.username }}" required>

                    <label class="form-label-block">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <small>(å¤‰æ›´ä¸å¯)</small></label>
                    <input type="email" value="{{ user.email }}" disabled style="background-color: #f1f5f9; color: #64748b;">

                    <label class="form-label-block">å­¦éƒ¨</label>
                    <div class="form-group">
                        <select name="faculty" required>
                            <option value="">--------</option>
                            <option value="å·¥å­¦éƒ¨" {% if user.faculty == 'å·¥å­¦éƒ¨' %}selected{% endif %}>å·¥å­¦éƒ¨</option>
                            <option value="ç†å­¦éƒ¨" {% if user.faculty == 'ç†å­¦éƒ¨' %}selected{% endif %}>ç†å­¦éƒ¨</option>
                            <option value="å›½éš›åœ°åŸŸå‰µé€ å­¦éƒ¨" {% if user.faculty == 'å›½éš›åœ°åŸŸå‰µé€ å­¦éƒ¨' %}selected{% endif %}>å›½éš›åœ°åŸŸå‰µé€ å­¦éƒ¨</option>
                            <option value="æ•™è‚²å­¦éƒ¨" {% if user.faculty == 'æ•™è‚²å­¦éƒ¨' %}selected{% endif %}>æ•™è‚²å­¦éƒ¨</option>
                            <option value="äººæ–‡ç¤¾ä¼šå­¦éƒ¨" {% if user.faculty == 'äººæ–‡ç¤¾ä¼šå­¦éƒ¨' %}selected{% endif %}>äººæ–‡ç¤¾ä¼šå­¦éƒ¨</option>
                            <option value="è¾²å­¦éƒ¨" {% if user.faculty == 'è¾²å­¦éƒ¨' %}selected{% endif %}>è¾²å­¦éƒ¨</option>
                            <option value="åŒ»å­¦éƒ¨" {% if user.faculty == 'åŒ»å­¦éƒ¨' %}selected{% endif %}>åŒ»å­¦éƒ¨</option>
                        </select>
                    </div>

                    <label class="form-label-block">å­¦ç§‘ãƒ»ã‚³ãƒ¼ã‚¹</label>
                    <input type="text" name="department" placeholder="ä¾‹: çŸ¥èƒ½æƒ…å ±ã‚³ãƒ¼ã‚¹" value="{{ user.department or '' }}" required class="mb-20">

                    <label class="form-label-block">å­¦å¹´</label>
                    <div class="form-group">
                        <select name="grade" required>
                            <option value="">--------</option>
                            <option value="1å¹´" {% if user.grade == '1å¹´' %}selected{% endif %}>1å¹´</option>
                            <option value="2å¹´" {% if user.grade == '2å¹´' %}selected{% endif %}>2å¹´</option>
                            <option value="3å¹´" {% if user.grade == '3å¹´' %}selected{% endif %}>3å¹´</option>
                            <option value="4å¹´" {% if user.grade == '4å¹´' %}selected{% endif %}>4å¹´</option>
                            <option value="ä¿®å£«1å¹´" {% if user.grade == 'ä¿®å£«1å¹´' %}selected{% endif %}>ä¿®å£«1å¹´</option>
                            <option value="ä¿®å£«2å¹´" {% if user.grade == 'ä¿®å£«2å¹´' %}selected{% endif %}>ä¿®å£«2å¹´</option>
                            <option value="åšå£«å¾ŒæœŸ" {% if user.grade == 'åšå£«å¾ŒæœŸ' %}selected{% endif %}>åšå£«å¾ŒæœŸ</option>
                            <option value="ãã®ä»–" {% if user.grade == 'ãã®ä»–' %}selected{% endif %}>ãã®ä»–</option>
                        </select>
                    </div>

                    <div style="margin-top: 40px; display: flex; gap: 20px; align-items: center;">
                        <a href="{{ url_for('index') }}" class="btn-cancel" style="flex: 1; text-align: center;">æˆ»ã‚‹</a>
                        <button type="submit" class="btn" style="flex: 2;">ä¿å­˜ã™ã‚‹</button>
                    </div>
                </form>
            </div>
        </section>
    </div>
</body>
</html>